# Система управления меню столовой

Лабораторная работа по курсу "Базы данных"
**Тема:** Создание меню для столовой

## Описание проекта

Веб-приложение для управления меню столовой, разработанное с использованием архитектурного паттерна MVC (Model-View-Controller). Система позволяет управлять блюдами, категориями и ингредиентами, предоставляя удобный интерфейс для администрирования меню.

## Функциональные возможности

### Управление блюдами
- Просмотр всех блюд с фильтрацией по категориям
- Добавление новых блюд
- Редактирование существующих блюд
- Удаление блюд
- Просмотр детальной информации о блюде
- Управление составом блюда (ингредиенты)
- Указание цены, веса и доступности блюда

### Управление категориями
- Просмотр всех категорий
- Добавление новых категорий
- Редактирование категорий
- Удаление категорий
- Подсчет количества блюд в каждой категории

### Управление ингредиентами
- Просмотр всех ингредиентов
- Добавление новых ингредиентов
- Редактирование ингредиентов
- Удаление ингредиентов
- Указание единиц измерения
- Отслеживание использования ингредиентов в блюдах

## Технологии

- **Node.js** - серверная платформа JavaScript
- **Express** - веб-фреймворк для Node.js
- **PostgreSQL** - реляционная СУБД
- **pg** - драйвер PostgreSQL для Node.js
- **Handlebars (hbs)** - шаблонизатор для генерации HTML
- **Body-parser** - middleware для парсинга тел запросов
- **Bootstrap 5** - CSS фреймворк для стилизации

## Структура базы данных

База данных содержит 4 взаимосвязанные таблицы:

### 1. categories (Категории блюд)
- `id` - первичный ключ
- `name` - название категории (уникальное)
- `description` - описание категории

### 2. dishes (Блюда)
- `id` - первичный ключ
- `name` - название блюда
- `category_id` - внешний ключ на categories
- `description` - описание блюда
- `price` - цена блюда
- `weight` - вес в граммах
- `is_available` - доступность для заказа

### 3. ingredients (Ингредиенты)
- `id` - первичный ключ
- `name` - название ингредиента (уникальное)
- `unit` - единица измерения (г, мл, шт, л, кг)

### 4. dish_ingredients (Связь блюд и ингредиентов)
- `dish_id` - внешний ключ на dishes
- `ingredient_id` - внешний ключ на ingredients
- `quantity` - количество ингредиента в блюде

## Установка и запуск

### Требования

**Вариант 1: Запуск с Docker (рекомендуется)**
- Docker
- Docker Compose

**Вариант 2: Локальный запуск**
- Node.js (версия 14 или выше)
- PostgreSQL (версия 12 или выше)
- npm (поставляется с Node.js)

---

## Вариант 1: Быстрый запуск с Docker (РЕКОМЕНДУЕТСЯ)

Это самый простой способ запустить приложение. Docker автоматически установит и настроит все зависимости.

### Требования
- Установленный Docker
- Установленный Docker Compose

### Запуск

1. Клонируйте или скопируйте проект
2. Перейдите в директорию проекта:
```bash
cd CanteenMenu
```

3. Запустите приложение одной командой:
```bash
docker-compose up
```

Или в фоновом режиме:
```bash
docker-compose up -d
```

### Готово!

Приложение автоматически:
- Создаст базу данных PostgreSQL
- Выполнит SQL скрипт с тестовыми данными
- Запустит веб-приложение

**Приложение доступно:** http://localhost:3000
**PostgreSQL доступен:** localhost:10748

### Управление Docker-контейнерами

**Остановка:**
```bash
docker-compose down
```

**Остановка с удалением данных:**
```bash
docker-compose down -v
```

**Просмотр логов:**
```bash
docker-compose logs -f
```

**Пересборка после изменений:**
```bash
docker-compose up --build
```

**Подключение к PostgreSQL извне:**
```bash
psql -h localhost -p 10748 -U postgres -d canteen_db
```
Пароль: `postgres`

---

## Вариант 2: Локальная установка (без Docker)

Если вы хотите запустить приложение без Docker, следуйте инструкциям ниже.

### Шаг 1: Установка PostgreSQL

Если PostgreSQL еще не установлен:

**Arch Linux:**
```bash
sudo pacman -S postgresql
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### Шаг 2: Создание базы данных

Войдите в PostgreSQL:
```bash
sudo -u postgres psql
```

Создайте базу данных:
```sql
CREATE DATABASE canteen_db;
\q
```

Выполните SQL скрипт для создания таблиц:
```bash
sudo -u postgres psql -d canteen_db -f database/create_db.sql
```

### Шаг 3: Настройка подключения к БД (опционально)

Приложение использует значения по умолчанию:
- host: `localhost`
- port: `5432`
- database: `canteen_db`
- user: `postgres`
- password: `postgres`

Если ваши настройки отличаются, установите переменные окружения:
```bash
export DATABASE_HOST=localhost
export DATABASE_PORT=5432
export DATABASE_NAME=canteen_db
export DATABASE_USER=postgres
export DATABASE_PASSWORD=ваш_пароль
```

### Шаг 4: Установка зависимостей

Перейдите в директорию проекта и установите зависимости:
```bash
cd CanteenMenu
npm install
```

### Шаг 5: Запуск приложения

Запустите сервер:
```bash
npm start
```

Для разработки с автоматической перезагрузкой:
```bash
npm run dev
```

Приложение будет доступно по адресу: **http://localhost:3000**

## Структура проекта

```
CanteenMenu/
├── Controllers/              # Контроллеры (бизнес-логика)
│   ├── homeController.js     # Главная страница
│   ├── dishController.js     # Управление блюдами
│   ├── categoryController.js # Управление категориями
│   └── ingredientController.js # Управление ингредиентами
├── Routes/                   # Маршруты (роутеры)
│   ├── homeRouter.js
│   ├── dishRouter.js
│   ├── categoryRouter.js
│   └── ingredientRouter.js
├── Views/                    # Представления (Handlebars)
│   ├── layouts/              # Шаблоны макетов
│   │   └── main.hbs
│   ├── Home/                 # Главные страницы
│   │   ├── Index.hbs
│   │   └── About.hbs
│   ├── Dishes/               # Страницы блюд
│   │   ├── Dishes.hbs
│   │   ├── addDish.hbs
│   │   ├── editDish.hbs
│   │   └── dishDetails.hbs
│   ├── Categories/           # Страницы категорий
│   │   ├── Categories.hbs
│   │   ├── addCategory.hbs
│   │   └── editCategory.hbs
│   └── Ingredients/          # Страницы ингредиентов
│       ├── Ingredients.hbs
│       ├── addIngredient.hbs
│       └── editIngredient.hbs
├── public/                   # Статические файлы
│   └── css/
│       └── style.css
├── database/                 # SQL скрипты
│   └── create_db.sql
├── db.js                     # Подключение к БД
├── app.js                    # Главный файл приложения
├── package.json              # Зависимости проекта
└── README.md                 # Документация
```

## Архитектура MVC

### Model (Модель)
База данных PostgreSQL с таблицами и их связями. Доступ к данным осуществляется через пул подключений (db.js).

### View (Представление)
Handlebars шаблоны (.hbs файлы) для отображения данных пользователю. Используется главный layout (main.hbs) и отдельные представления для каждой страницы.

### Controller (Контроллер)
JavaScript файлы, содержащие функции обработки запросов, бизнес-логику и взаимодействие с базой данных.

## Основные маршруты

- `/` - Главная страница
- `/about` - О программе
- `/dishes` - Список блюд
- `/dishes/add` - Добавить блюдо
- `/dishes/:id/edit` - Редактировать блюдо
- `/dishes/:id/details` - Детали блюда
- `/categories` - Список категорий
- `/categories/add` - Добавить категорию
- `/categories/:id/edit` - Редактировать категорию
- `/ingredients` - Список ингредиентов
- `/ingredients/add` - Добавить ингредиент
- `/ingredients/:id/edit` - Редактировать ингредиент

## Особенности реализации

### CRUD операции
Реализованы полные CRUD (Create, Read, Update, Delete) операции для всех сущностей:
- Блюда
- Категории
- Ингредиенты

### Фильтрация
Блюда можно фильтровать по категориям через выпадающий список.

### Связи между таблицами
- Каждое блюдо принадлежит одной категории (one-to-many)
- Блюдо может иметь несколько ингредиентов, и один ингредиент может входить в несколько блюд (many-to-many)

### Транзакции
При добавлении и редактировании блюд используются транзакции для обеспечения целостности данных при работе с связанными таблицами.

### Валидация
- Проверка уникальности названий категорий и ингредиентов
- Проверка наличия блюд перед удалением категории
- Проверка использования ингредиента перед удалением

## Возможные проблемы и решения

### Ошибка подключения к PostgreSQL
Убедитесь, что:
- PostgreSQL запущен (`sudo systemctl status postgresql`)
- Правильно указаны учетные данные в `db.js`
- База данных создана

### Ошибка "Cannot find module"
Установите зависимости:
```bash
npm install
```

### Порт 3000 занят
Измените порт в файле `app.js`:
```javascript
const PORT = 3000; // измените на другой порт
```

## Автор

Лабораторная работа по курсу "Базы данных"
Тема: Создание меню для столовой

## Лицензия

Данный проект создан в учебных целях.
