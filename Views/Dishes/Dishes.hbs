<div class="row">
    <div class="col-md-12">
        <h1>–ú–µ–Ω—é —Å—Ç–æ–ª–æ–≤–æ–π</h1>
        <hr>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-6">
        <a href="/dishes/add" class="btn btn-success">+ –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</a>
    </div>
    <div class="col-md-6">
        <form method="GET" action="/dishes" class="d-flex gap-2">
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <select name="category_id" class="form-select" onchange="this.form.submit()">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                {{#each categories}}
                    <option value="{{this.id}}" {{#if (eq this.id ../selectedCategory)}}selected{{/if}}>
                        {{this.name}}
                    </option>
                {{/each}}
            </select>

            <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ -->
            <select name="price_range" class="form-select" onchange="this.form.submit()">
                <option value="">–í—Å–µ —Ü–µ–Ω—ã</option>
                <option value="under50" {{#if (eq selectedPriceRange 'under50')}}selected{{/if}}>–î–æ 50 —Ä—É–±</option>
                <option value="50-100" {{#if (eq selectedPriceRange '50-100')}}selected{{/if}}>50-100 —Ä—É–±</option>
                <option value="100-150" {{#if (eq selectedPriceRange '100-150')}}selected{{/if}}>100-150 —Ä—É–±</option>
                <option value="150-200" {{#if (eq selectedPriceRange '150-200')}}selected{{/if}}>150-200 —Ä—É–±</option>
                <option value="over200" {{#if (eq selectedPriceRange 'over200')}}selected{{/if}}>–û—Ç 200 —Ä—É–±</option>
            </select>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω –ª—é–±–æ–π —Ñ–∏–ª—å—Ç—Ä) -->
            {{#if (or selectedCategory selectedPriceRange)}}
                <a href="/dishes" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
            {{/if}}
        </form>
    </div>
</div>

{{#if dishes.length}}
<div class="row">
    {{#each dishes}}
    <div class="col-md-4 mb-3">
        <div class="card h-100">
            {{#if this.image_url}}
                <img src="{{this.image_url}}" class="card-img-top" alt="{{this.name}}">
            {{else}}
                <div class="dish-image-placeholder">üçΩÔ∏è</div>
            {{/if}}
            <div class="card-body">
                <h5 class="card-title">{{this.name}}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{this.category_name}}</h6>
                {{#if this.description}}
                <p class="card-text">{{this.description}}</p>
                {{/if}}
                <p class="card-text">
                    <strong>–¶–µ–Ω–∞:</strong> {{this.price}} —Ä—É–±.<br>
                    {{#if this.weight}}
                    <strong>–í–µ—Å:</strong> {{this.weight}} –≥<br>
                    {{/if}}
                    <strong>–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:</strong>
                    {{#if this.is_available}}
                        <span class="badge bg-success">–î–æ—Å—Ç—É–ø–Ω–æ</span>
                    {{else}}
                        <span class="badge bg-danger">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>
                    {{/if}}
                </p>
            </div>
            <div class="card-footer">
                <a href="/dishes/{{this.id}}/details" class="btn btn-sm btn-info">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>

                {{#if this.is_available}}
                <form method="POST" action="/cart/add" style="display:inline;">
                    <input type="hidden" name="dish_id" value="{{this.id}}">
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="btn btn-sm btn-success">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                </form>
                {{/if}}

                <a href="/dishes/{{this.id}}/edit" class="btn btn-sm btn-warning">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <form method="POST" action="/dishes/{{this.id}}/delete" style="display:inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±–ª—é–¥–æ?');">
                    <button type="submit" class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
    {{/each}}
</div>
{{else}}
<div class="alert alert-info">
    –ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
    {{#if (or selectedCategory selectedPriceRange)}}
        –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ <a href="/dishes">–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –±–ª—é–¥–∞</a>.
    {{else}}
        <a href="/dishes/add">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ</a>.
    {{/if}}
</div>
{{/if}}
