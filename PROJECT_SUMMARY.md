# Отчет по лабораторной работе

## Тема: Создание меню для столовой

**Курс:** Базы данных
**Год:** 2024

---

## 1. Цель работы

Разработать веб-приложение для управления меню столовой с использованием:
- Архитектурного паттерна MVC (Model-View-Controller)
- СУБД PostgreSQL
- Платформы Node.js с фреймворком Express
- Шаблонизатора Handlebars

---

## 2. Задачи проекта

1. Спроектировать структуру базы данных с минимум 4 взаимосвязанными таблицами
2. Реализовать CRUD операции (Create, Read, Update, Delete) для всех сущностей
3. Реализовать фильтрацию данных по категориям
4. Создать удобный пользовательский интерфейс
5. Обеспечить целостность данных через транзакции
6. Реализовать связи "один-ко-многим" и "многие-ко-многим"

---

## 3. Проектирование базы данных

### 3.1 Структура таблиц

**Таблица: categories (Категории блюд)**
```sql
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT
);
```

**Таблица: dishes (Блюда)**
```sql
CREATE TABLE dishes (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    category_id INTEGER NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    weight INTEGER,
    is_available BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE
);
```

**Таблица: ingredients (Ингредиенты)**
```sql
CREATE TABLE ingredients (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    unit VARCHAR(20) NOT NULL
);
```

**Таблица: dish_ingredients (Связь блюд и ингредиентов)**
```sql
CREATE TABLE dish_ingredients (
    dish_id INTEGER NOT NULL,
    ingredient_id INTEGER NOT NULL,
    quantity DECIMAL(10, 2) NOT NULL,
    PRIMARY KEY (dish_id, ingredient_id),
    FOREIGN KEY (dish_id) REFERENCES dishes(id) ON DELETE CASCADE,
    FOREIGN KEY (ingredient_id) REFERENCES ingredients(id) ON DELETE CASCADE
);
```

### 3.2 Связи между таблицами

1. **categories → dishes** (Один ко многим)
   - Одна категория может содержать много блюд
   - Каждое блюдо принадлежит одной категории
   - Cascade удаление: при удалении категории удаляются все её блюда

2. **dishes ↔ ingredients** (Многие ко многим)
   - Одно блюдо может содержать много ингредиентов
   - Один ингредиент может входить в много блюд
   - Реализовано через промежуточную таблицу dish_ingredients

### 3.3 Индексы для оптимизации

```sql
CREATE INDEX idx_dishes_category ON dishes(category_id);
CREATE INDEX idx_dishes_available ON dishes(is_available);
CREATE INDEX idx_dish_ingredients_dish ON dish_ingredients(dish_id);
CREATE INDEX idx_dish_ingredients_ingredient ON dish_ingredients(ingredient_id);
```

---

## 4. Архитектура приложения (MVC)

### 4.1 Model (Модель)

**База данных PostgreSQL**
- 4 взаимосвязанные таблицы
- Ограничения целостности (Foreign Keys, Unique, Not Null)
- Индексы для быстрого поиска

**Файл: db.js**
- Пул подключений к PostgreSQL
- Использование модуля pg

### 4.2 View (Представление)

**Шаблонизатор Handlebars**
- Главный layout (main.hbs)
- Представления для каждой сущности
- Формы добавления и редактирования
- Списки и таблицы

**Структура представлений:**
```
Views/
├── layouts/main.hbs          # Основной шаблон
├── Home/                     # Главные страницы
│   ├── Index.hbs
│   └── About.hbs
├── Dishes/                   # Блюда
│   ├── Dishes.hbs           # Список
│   ├── addDish.hbs          # Добавление
│   ├── editDish.hbs         # Редактирование
│   └── dishDetails.hbs      # Детали
├── Categories/               # Категории
│   ├── Categories.hbs
│   ├── addCategory.hbs
│   └── editCategory.hbs
└── Ingredients/              # Ингредиенты
    ├── Ingredients.hbs
    ├── addIngredient.hbs
    └── editIngredient.hbs
```

### 4.3 Controller (Контроллер)

**Контроллеры:**
1. **homeController.js** - главная страница, о программе
2. **dishController.js** - управление блюдами
3. **categoryController.js** - управление категориями
4. **ingredientController.js** - управление ингредиентами

**Каждый контроллер включает функции:**
- Получение списка
- Отображение формы добавления
- Обработка добавления
- Отображение формы редактирования
- Обработка редактирования
- Удаление

---

## 5. Реализованная функциональность

### 5.1 Управление блюдами

✅ Просмотр всех блюд
✅ Фильтрация блюд по категориям
✅ Добавление нового блюда
✅ Редактирование блюда
✅ Удаление блюда
✅ Просмотр детальной информации
✅ Управление составом блюда (ингредиенты)
✅ Указание цены, веса, доступности

### 5.2 Управление категориями

✅ Просмотр всех категорий
✅ Добавление категории
✅ Редактирование категории
✅ Удаление категории
✅ Подсчет количества блюд в категории
✅ Защита от удаления категорий с блюдами

### 5.3 Управление ингредиентами

✅ Просмотр всех ингредиентов
✅ Добавление ингредиента
✅ Редактирование ингредиента
✅ Удаление ингредиента
✅ Различные единицы измерения
✅ Отслеживание использования
✅ Защита от удаления используемых ингредиентов

---

## 6. Особенности реализации

### 6.1 Транзакции

При добавлении/редактировании блюд используются транзакции для обеспечения целостности:

```javascript
const client = await pool.connect();
try {
    await client.query('BEGIN');
    // Вставка блюда
    // Добавление ингредиентов
    await client.query('COMMIT');
} catch (err) {
    await client.query('ROLLBACK');
    throw err;
} finally {
    client.release();
}
```

### 6.2 Валидация данных

**На уровне базы данных:**
- UNIQUE ограничения для названий
- NOT NULL для обязательных полей
- Foreign Key для связей

**На уровне приложения:**
- Проверка заполненности обязательных полей
- Проверка существования связанных записей
- Обработка ошибок уникальности

### 6.3 Обработка ошибок

```javascript
try {
    // Операции с БД
} catch (err) {
    if (err.code === '23505') {
        // Ошибка уникальности
    }
    console.error('Ошибка:', err);
    res.status(500).send('Ошибка сервера');
}
```

---

## 7. Технологический стек

| Компонент | Технология | Версия |
|-----------|-----------|--------|
| Серверная платформа | Node.js | 14+ |
| Веб-фреймворк | Express | 4.18.2 |
| СУБД | PostgreSQL | 12+ |
| Драйвер БД | pg | 8.11.3 |
| Шаблонизатор | Handlebars (hbs) | 4.2.0 |
| Парсер тел запросов | body-parser | 1.20.2 |
| CSS фреймворк | Bootstrap | 5.3.0 |

---

## 8. Структура проекта

```
CanteenMenu/
├── Controllers/              # Контроллеры
│   ├── homeController.js
│   ├── dishController.js
│   ├── categoryController.js
│   └── ingredientController.js
├── Routes/                   # Маршруты
│   ├── homeRouter.js
│   ├── dishRouter.js
│   ├── categoryRouter.js
│   └── ingredientRouter.js
├── Views/                    # Представления
│   ├── layouts/
│   ├── Home/
│   ├── Dishes/
│   ├── Categories/
│   └── Ingredients/
├── public/                   # Статические файлы
│   └── css/style.css
├── database/                 # SQL скрипты
│   ├── create_db.sql
│   └── database_schema.txt
├── db.js                     # Подключение к БД
├── app.js                    # Главный файл
├── package.json              # Зависимости
├── README.md                 # Документация
├── USER_GUIDE.md             # Руководство пользователя
└── .gitignore
```

---

## 9. Установка и запуск

### Шаг 1: Установка PostgreSQL
```bash
sudo pacman -S postgresql  # Arch Linux
sudo apt install postgresql  # Ubuntu/Debian
```

### Шаг 2: Создание базы данных
```bash
sudo -u postgres psql
CREATE DATABASE canteen_db;
\q
```

### Шаг 3: Загрузка структуры БД
```bash
sudo -u postgres psql -d canteen_db -f database/create_db.sql
```

### Шаг 4: Настройка подключения
Отредактировать `db.js` с учетными данными PostgreSQL

### Шаг 5: Установка зависимостей
```bash
npm install
```

### Шаг 6: Запуск приложения
```bash
npm start
```

Приложение доступно: http://localhost:3000

---

## 10. Тестирование

### Тестовые данные

SQL скрипт включает тестовые данные:
- 6 категорий
- 25 блюд
- 23 ингредиента
- Связи блюд с ингредиентами

### Сценарии тестирования

1. **CRUD операции для категорий**
   - ✅ Создание
   - ✅ Чтение
   - ✅ Обновление
   - ✅ Удаление

2. **CRUD операции для ингредиентов**
   - ✅ Все операции работают

3. **CRUD операции для блюд**
   - ✅ Все операции работают
   - ✅ Работа с ингредиентами

4. **Фильтрация**
   - ✅ По категориям

5. **Валидация**
   - ✅ Уникальность названий
   - ✅ Обязательные поля
   - ✅ Защита от удаления

---

## 11. Результаты работы

### Достигнутые цели

✅ Создано полнофункциональное веб-приложение
✅ Реализована архитектура MVC
✅ База данных с 4 таблицами и связями
✅ CRUD операции для всех сущностей
✅ Фильтрация данных
✅ Транзакции для целостности данных
✅ Удобный пользовательский интерфейс
✅ Подробная документация

### Полученные навыки

- Проектирование реляционных баз данных
- Работа с PostgreSQL
- Разработка веб-приложений на Node.js
- Применение паттерна MVC
- Работа с шаблонизаторами
- SQL запросы (SELECT, INSERT, UPDATE, DELETE, JOIN)
- Транзакции и обработка ошибок
- Работа с Bootstrap для стилизации

---

## 12. Возможные улучшения

### Функциональные
- Добавление системы пользователей и аутентификации
- Реализация корзины для заказов
- История заказов
- Статистика продаж
- Поиск по блюдам
- Экспорт меню в PDF
- Управление запасами ингредиентов

### Технические
- REST API для мобильных приложений
- Использование ORM (Sequelize, TypeORM)
- Миграции базы данных
- Unit и интеграционные тесты
- Логирование
- Кэширование
- Пагинация для больших списков

---

## 13. Заключение

В результате выполнения лабораторной работы было разработано полноценное веб-приложение для управления меню столовой. Приложение соответствует всем требованиям:

- Использует архитектурный паттерн MVC
- Работает с PostgreSQL
- Имеет 4 взаимосвязанные таблицы
- Реализует полный набор CRUD операций
- Обеспечивает целостность данных
- Имеет понятный пользовательский интерфейс

Проект демонстрирует практическое применение знаний по:
- Проектированию баз данных
- Веб-разработке
- Работе с СУБД
- Архитектурным паттернам

---

## 14. Список использованных источников

1. Документация Node.js - https://nodejs.org/
2. Документация Express - https://expressjs.com/
3. Документация PostgreSQL - https://www.postgresql.org/docs/
4. Документация Handlebars - https://handlebarsjs.com/
5. Bootstrap 5 - https://getbootstrap.com/
6. Методические материалы курса "Базы данных"

---

**Дата выполнения:** 2024
**Выполнил:** [Ваше имя]
**Группа:** [Номер группы]
